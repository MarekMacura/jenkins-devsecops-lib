pipeline {  
    agent any  
    stages {  
        stage('Build') {  
            steps {  
                script {  
                    def buildData = [  
                        build_number: env.BUILD_NUMBER,  
                        job_name: env.JOB_NAME,  
                        build_status: currentBuild.currentResult,  
                        duration_ms: currentBuild.duration,  
                        timestamp: System.currentTimeMillis(),  
                        mean_time_to_deploy: 120000, // example metric in ms  
                        build_frequency: 5 // builds/day example  
                    ]  
  
                    // Convert to JSON  
                    def json = groovy.json.JsonOutput.toJson([  
                        event: buildData  
                    ])  
  
                    // Send to Splunk HEC  
                    sh """  
                      curl -k \  
                        https://splunk-server:8088/services/collector \  
                        -H 'Authorization: Splunk <YOUR_HEC_TOKEN>' \  
                        -H 'Content-Type: application/json' \  
                        -d '${json}'  
                    """  
                }  
            }  
        }  
    }  
}  
